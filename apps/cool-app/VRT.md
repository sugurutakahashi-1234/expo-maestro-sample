# VRT (Visual Regression Testing) ã‚¬ã‚¤ãƒ‰

## ç›®æ¬¡
1. [æ¦‚è¦](#æ¦‚è¦)
2. [ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (æ¨å¥¨)](#ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼-æ¨å¥¨)
3. [ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (CI/CDç”¨)](#ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼-cicdç”¨)
4. [ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç®¡ç†](#ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç®¡ç†)
5. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
6. [æŠ€è¡“è©³ç´°](#æŠ€è¡“è©³ç´°)

---

## æ¦‚è¦

### VRTã¨ã¯

Maestro E2Eãƒ†ã‚¹ãƒˆã§ç”Ÿæˆã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ã€UIã®è¦–è¦šçš„ãªå¤‰æ›´ã‚’æ¤œå‡ºã™ã‚‹ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ã€‚

### 2ã¤ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | ãƒ„ãƒ¼ãƒ« | ç”¨é€” | å®Ÿè¡Œç’°å¢ƒ |
|------------|--------|------|---------|
| **ãƒ­ãƒ¼ã‚«ãƒ«** | reg-cli | é–‹ç™ºä¸­ã®UIç¢ºèª | ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ |
| **ãƒªãƒ¢ãƒ¼ãƒˆ** | reg-suit + GCS | CI/CDã€ãƒãƒ¼ãƒ å…±æœ‰ | GitHub Actions |

### ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜å…ˆ

- **ãƒ­ãƒ¼ã‚«ãƒ«**: `.maestro/snapshots/{branch}/{version}/{hash}/`
- **ãƒªãƒ¢ãƒ¼ãƒˆ**: GCS bucket `vrt-sample` (asia-northeast1)

---

## ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (æ¨å¥¨)

æ—¥å¸¸çš„ãªé–‹ç™ºã§ä½¿ç”¨ã™ã‚‹ä¸»è¦ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€‚

### åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

```bash
# 1. Maestroãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå–å¾—
bun run maestro:ios

# 2. ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ
bun run vrt:snapshot:local
# â†’ .maestro/snapshots/{branch}/{version}/{hash}/

# 4. ãƒãƒƒã‚·ãƒ¥ã‹ã‚‰æ¯”è¼ƒã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆ
bun run vrt:find:local def456 abc123

# 5. å‡ºåŠ›ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼&å®Ÿè¡Œ
# actual (newer: def456) vs expected (older: abc123)
npx reg-cli .maestro/snapshots/feature/... .maestro/snapshots/main/... .reg/local/diff -R .reg/local/index.html -J .reg/local/reg.json -T 0.001; open .reg/local/index.html
```

### å®Ÿè·µä¾‹

#### ä¾‹1: ãƒªãƒªãƒ¼ã‚¹å‰ã®UIç¢ºèª

```bash
# 1. mainã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ä½œæˆ
git checkout main && git pull
bun run maestro:ios
bun run vrt:snapshot:local

# 2. ãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ
git checkout release/v1.1.0
bun run maestro:ios
bun run vrt:snapshot:local

# 3. æ¯”è¼ƒ (release ãŒ actual, main ãŒ expected)
bun run vrt:find:local <release-hash> <main-hash>
# â†’ å‡ºåŠ›ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
```

#### ä¾‹2: æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒã®å½±éŸ¿ç¯„å›²ç¢ºèª

```bash
# 1. mainã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ä½œæˆ
git checkout main
bun run maestro:ios
bun run vrt:snapshot:local

# 2. æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ
git checkout feature/new-ui
bun run maestro:ios
bun run vrt:snapshot:local

# 3. æ¯”è¼ƒ (feature ãŒ actual, main ãŒ expected)
bun run vrt:find:local <feature-hash> <main-hash>
```

#### ä¾‹3: å¼·åˆ¶ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ

WIPçŠ¶æ…‹ã§ã‚‚ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆã—ãŸã„å ´åˆï¼š

```bash
# --forceãƒ•ãƒ©ã‚°ã§æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ãŒã‚ã£ã¦ã‚‚ä½œæˆ
bun run vrt:snapshot:local:force
```

### reg-cliã®å‡ºåŠ›ã®è¦‹æ–¹

æ¯”è¼ƒçµæœã¯è‡ªå‹•çš„ã«HTMLãƒ¬ãƒãƒ¼ãƒˆã¨ã—ã¦é–‹ãã¾ã™ï¼š

- **Changed items**: å·®åˆ†ãŒæ¤œå‡ºã•ã‚ŒãŸç”»åƒ
- **New items**: æ–°è¦è¿½åŠ ã•ã‚ŒãŸç”»åƒ
- **Deleted items**: å‰Šé™¤ã•ã‚ŒãŸç”»åƒ
- **Passed items**: å®Œå…¨ã«ä¸€è‡´ã—ãŸç”»åƒ

---

## ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (CI/CDç”¨)

GitHub Actionsã§ã®VRTè‡ªå‹•å®Ÿè¡Œã¨ãƒãƒ¼ãƒ å…±æœ‰ç”¨ã€‚GCSã«2ã¤ã®å½¢å¼ã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä¿å­˜ã—ã¾ã™ã€‚

### 2é‡ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥ã®ä»•çµ„ã¿

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯2ã¤ã®GCSã‚­ãƒ¼ã§ä¿å­˜ã•ã‚Œã¾ã™ï¼š

1. **ãƒãƒƒã‚·ãƒ¥ã®ã¿ (`{hash}/`)**: CI/CDæ¯”è¼ƒç”¨
   - ä¾‹: `041e30c/`, `f6e97f4/`
   - é«˜é€Ÿæ¤œç´¢å¯èƒ½

2. **ãƒ•ãƒ«ãƒ‘ã‚¹ (`{branch}/{version}/{hash}/`)**: å±¥æ­´ä¿å­˜ç”¨
   - ä¾‹: `main/1.0.0/041e30c/`, `feature_new-ui/1.0.0/f6e97f4/`
   - ãƒ–ãƒ©ãƒ³ãƒãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¥ã«æ•´ç†ã•ã‚Œã€éå»å‚ç…§ã—ã‚„ã™ã„

### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹å‰ã«ã€GCSèªè¨¼æƒ…å ±ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```bash
# 1. exampleãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
cp vrt-gcs-credentials.json.example vrt-gcs-credentials.json

# 2. GCPã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’å–å¾—
# https://console.cloud.google.com/iam-admin/serviceaccounts

# 3. å–å¾—ã—ãŸJSONã®å†…å®¹ã§vrt-gcs-credentials.jsonã‚’ä¸Šæ›¸ã
# ï¼ˆproject_id, private_key, client_emailãªã©ã‚’å®Ÿéš›ã®å€¤ã«ç½®ãæ›ãˆï¼‰
```

**é‡è¦**: `vrt-gcs-credentials.json` ã¯ `.gitignore` ã§é™¤å¤–ã•ã‚Œã¦ã„ã¾ã™ã€‚çµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„ã€‚

### åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«æ‰‹å‹•å®Ÿè¡Œç”¨ï¼‰

```bash
# 1. Maestroãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå–å¾—
bun run maestro:ios

# 2. ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã‚’ç”Ÿæˆï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«å®Ÿè¡Œç”¨ï¼‰
bun run vrt:publish:manual
# â†’ å¼•æ•°ãªã—ï¼ˆ.maestro/screenshots ã‚’è‡ªå‹•æ¤œå‡ºï¼‰
# â†’ ã‚³ãƒãƒ³ãƒ‰1: ãƒãƒƒã‚·ãƒ¥ã®ã¿ã®ã‚­ãƒ¼
# â†’ ã‚³ãƒãƒ³ãƒ‰2: ãƒ•ãƒ«ãƒ‘ã‚¹ã®ã‚­ãƒ¼

# 3. å‡ºåŠ›ã•ã‚ŒãŸ2ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã‚’é †æ¬¡å®Ÿè¡Œ
```

**æ³¨**: `vrt:publish:manual` ã¯ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆã®ã¿ã‚’è¡Œã„ã¾ã™ã€‚å®Ÿéš›ã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥ã¯å‡ºåŠ›ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚CI/CDã§ã¯ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã›ãšã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§ç›´æ¥ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

### å®Ÿè·µä¾‹

#### mainãƒ–ãƒ©ãƒ³ãƒã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ä½œæˆ

```bash
git checkout main && git pull
bun run maestro:ios

bun run vrt:publish:manual
# GCSã«2ã¤ã®ã‚­ãƒ¼ã§ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥:
# 1. ãƒãƒƒã‚·ãƒ¥ã®ã¿ï¼ˆæ¯”è¼ƒç”¨ï¼‰: 041e30c
# 2. ãƒ•ãƒ«ãƒ‘ã‚¹ï¼ˆä¿å­˜ç”¨ï¼‰: main/1.0.0/041e30c
#
# ã‚³ãƒãƒ³ãƒ‰1: ãƒãƒƒã‚·ãƒ¥ã®ã¿ã®ã‚­ãƒ¼ã§ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥
# rm -rf .reg && ACTUAL_KEY=041e30c ...
#
# ã‚³ãƒãƒ³ãƒ‰2: ãƒ•ãƒ«ãƒ‘ã‚¹ã®ã‚­ãƒ¼ã§ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥
# rm -rf .reg && ACTUAL_KEY=main/1.0.0/041e30c ...

# â†’ 2ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã—ã¦å®Ÿè¡Œ
```

### GCSæ§‹é€ 

```
vrt-sample/
â”œâ”€â”€ 041e30c/                    # ãƒãƒƒã‚·ãƒ¥ã®ã¿ï¼ˆæ¯”è¼ƒç”¨ï¼‰
â”‚   â””â”€â”€ ios/
â”‚       â”œâ”€â”€ home-tab.png
â”‚       â””â”€â”€ ...
â”œâ”€â”€ f6e97f4/
â”‚   â””â”€â”€ ios/...
â””â”€â”€ main/                       # ãƒ•ãƒ«ãƒ‘ã‚¹ï¼ˆå±¥æ­´ä¿å­˜ç”¨ï¼‰
    â””â”€â”€ 1.0.0/
        â”œâ”€â”€ 041e30c/
        â”‚   â””â”€â”€ ios/...
        â””â”€â”€ f6e97f4/
            â””â”€â”€ ios/...
```

### GCSè¨­å®š

- **ãƒã‚±ãƒƒãƒˆå**: `vrt-sample`
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: `asia-northeast1`
- **èªè¨¼ãƒ•ã‚¡ã‚¤ãƒ«**: `vrt-gcs-credentials.json` (gitignoreæ¸ˆã¿)
- **å·®åˆ†é–¾å€¤**: 0.1% (thresholdRate: 0.001)
- **2é‡ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥**: ãƒãƒƒã‚·ãƒ¥ã®ã¿ + ãƒ•ãƒ«ãƒ‘ã‚¹

---

## ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç®¡ç†

### å‘½åè¦å‰‡

```
{branch}/{version}/{hash}
```

- **branch**: ãƒ–ãƒ©ãƒ³ãƒåï¼ˆã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ã€`/` â†’ `_`ï¼‰(ä¾‹: `main`, `feature_new-ui`)
- **version**: package.jsonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ (ä¾‹: `1.0.0`)
- **hash**: ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥çŸ­ç¸®7æ–‡å­— (ä¾‹: `abc123d`)

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
.maestro/snapshots/
â”œâ”€â”€ main/
â”‚   â””â”€â”€ 1.0.0/
â”‚       â”œâ”€â”€ abc123d/
â”‚       â”‚   â””â”€â”€ ios/
â”‚       â”‚       â”œâ”€â”€ home-tab.png
â”‚       â”‚       â”œâ”€â”€ about-tab.png
â”‚       â”‚       â””â”€â”€ ...
â”‚       â””â”€â”€ def456a/
â”‚           â””â”€â”€ ...
â””â”€â”€ feature_change-ui/
    â””â”€â”€ 1.0.0/
        â””â”€â”€ f6e97f4/
            â””â”€â”€ ...
```

### ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```bash
# ç‰¹å®šãƒ–ãƒ©ãƒ³ãƒã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå‰Šé™¤
rm -rf .maestro/snapshots/feature_old/

# å¤ã„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¸€æ‹¬å‰Šé™¤ (30æ—¥ä»¥å‰)
find .maestro/snapshots -type d -mtime +30 -exec rm -rf {} +
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„

```bash
âŒ Error: Screenshots directory not found
ğŸ’¡ Run 'bun run maestro:ios' first
```

**è§£æ±ºæ–¹æ³•:**
```bash
bun run maestro:ios
bun run vrt:snapshot:local
```

### ã‚¨ãƒ©ãƒ¼: æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ãŒã‚ã‚‹

```bash
âŒ Uncommitted changes detected
ğŸ’¡ Commit first or use `--force` flag
```

**è§£æ±ºæ–¹æ³•:**
```bash
# æ–¹æ³•1: ã‚³ãƒŸãƒƒãƒˆã—ã¦ã‹ã‚‰å®Ÿè¡Œ
git add . && git commit -m "WIP"
bun run vrt:snapshot:local

# æ–¹æ³•2: --forceãƒ•ãƒ©ã‚°ä½¿ç”¨
bun run vrt:snapshot:local:force
```

### ã‚¨ãƒ©ãƒ¼: ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„

```bash
âŒ Snapshot not found for hash: abc123
```

**è§£æ±ºæ–¹æ³•:**
```bash
# æ­£ã—ã„ãƒãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ (f6e97f4 ãŒ actual, 041e30c ãŒ expected)
bun run vrt:find:local f6e97f4 041e30c
```

---

## CI/CDé‹ç”¨

GitHub Actionsã‚’ä½¿ç”¨ã—ãŸè‡ªå‹•VRTå®Ÿè¡Œã®é‹ç”¨æ–¹æ³•ã€‚

### æ¦‚è¦

**ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒãƒ¼ã‚¸å¾Œãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ›´æ–°**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼š

1. **mainãƒ–ãƒ©ãƒ³ãƒ** (mergeå¾Œ): ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’è‡ªå‹•æ›´æ–°
2. **PRãƒ–ãƒ©ãƒ³ãƒ**: mainã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨æ¯”è¼ƒ

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

#### 1. ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ›´æ–° (`.github/workflows/vrt-baseline.yml`)

mainãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸã¨ãã«è‡ªå‹•å®Ÿè¡Œï¼š

```yaml
on:
  push:
    branches: [main]

jobs:
  update-baseline:
    steps:
      - ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ (--force)
      - GCSå…¬é–‹
```

#### 2. PRæ¯”è¼ƒ (`.github/workflows/vrt-pr.yml`)

PRãŒä½œæˆãƒ»æ›´æ–°ã•ã‚ŒãŸã¨ãã«è‡ªå‹•å®Ÿè¡Œï¼š

```yaml
on:
  pull_request:

jobs:
  vrt-compare:
    steps:
      - PRã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ (--force)
      - GCSå…¬é–‹
      - mainãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨æ¯”è¼ƒ
```

### åˆ¶ç´„äº‹é …

1. **Maestroå®Ÿè¡Œä¸å¯**: CIç’°å¢ƒã§ã¯Maestroã‚’å®Ÿè¡Œã§ããªã„ãŸã‚ã€`.maestro/screenshots` ã‚’äº‹å‰ã«ã‚³ãƒŸãƒƒãƒˆå¿…è¦
2. **ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ**: CIç’°å¢ƒã§ã¯ `--force` ãƒ•ãƒ©ã‚°ã§å¼·åˆ¶ä½œæˆ

### GitHub Secretsè¨­å®šï¼ˆå¿…é ˆï¼‰

CI/CDé‹ç”¨ã«ã¯ä»¥ä¸‹ã®Secretã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### è¨­å®šæ‰‹é †

1. **GCPã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®å–å¾—**
   - [GCPã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.cloud.google.com/iam-admin/serviceaccounts)ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ
   - JSONã‚­ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

2. **GitHub Secretsã«ç™»éŒ²**
   - GitHubãƒªãƒã‚¸ãƒˆãƒªã® `Settings > Secrets and variables > Actions` ã‚’é–‹ã
   - `New repository secret` ã‚’ã‚¯ãƒªãƒƒã‚¯
   - **Name**: `VRT_GCS_CREDENTIALS_JSON`
   - **Secret**: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹å…¨ä½“ã‚’ãƒšãƒ¼ã‚¹ãƒˆ

#### Secretã®å†…å®¹ä¾‹
```json
{
  "type": "service_account",
  "project_id": "your-project-id",
  "private_key_id": "...",
  "private_key": "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n",
  "client_email": "vrt-service-account@your-project.iam.gserviceaccount.com",
  "client_id": "...",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "..."
}
```

#### CI/CDã§ã®èªè¨¼ãƒ•ãƒ­ãƒ¼

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§ Google å…¬å¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ `google-github-actions/auth@v3` ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

```yaml
- name: Authenticate to Google Cloud
  uses: google-github-actions/auth@v3
  with:
    credentials_json: '${{ secrets.VRT_GCS_CREDENTIALS_JSON }}'

- name: Publish to GCS
  run: |
    bunx reg-suit run
```

**åˆ©ç‚¹**:
- âœ… **ç°¡æ½”**: ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆãŒä¸è¦
- âœ… **è‡ªå‹•è¨­å®š**: `GOOGLE_APPLICATION_CREDENTIALS` ç’°å¢ƒå¤‰æ•°ãŒè‡ªå‹•ã§è¨­å®šã•ã‚Œã‚‹
- âœ… **è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ã‚¸ãƒ§ãƒ–çµ‚äº†æ™‚ã«èªè¨¼æƒ…å ±ãŒè‡ªå‹•å‰Šé™¤ã•ã‚Œã‚‹
- âœ… **Googleå…¬å¼**: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã•ã‚Œã¦ãŠã‚Šä¿¡é ¼æ€§ãŒé«˜ã„

**é‡è¦**:
- èªè¨¼æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`vrt-gcs-credentials.json`ï¼‰ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„
- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã¯ `vrt-gcs-credentials.json` ã‚’ä½¿ç”¨ã—ã€CI/CDã§ã¯GitHub Secretsã‚’ä½¿ç”¨ã—ã¾ã™

---

## PRã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½

`reg-notify-github-plugin` ã‚’ä½¿ç”¨ã—ã¦ã€VRTçµæœã‚’è‡ªå‹•çš„ã«PRã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¾ã™ã€‚

### æ©Ÿèƒ½

- âœ… **PRã«å·®åˆ†ãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ã‚³ãƒ¡ãƒ³ãƒˆ**: æ¯”è¼ƒçµæœã‚’PRã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æŠ•ç¨¿
- âœ… **ã‚³ãƒŸãƒƒãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¨­å®š**: å·®åˆ†ãŒã‚ã‚‹å ´åˆã¯ã‚³ãƒŸãƒƒãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’failã«è¨­å®š
- âœ… **æ—¢å­˜ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°**: é‡è¤‡ã‚³ãƒ¡ãƒ³ãƒˆã‚’é˜²æ­¢ã—ã€æ—¢å­˜ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°
- âœ… **ã‚µãƒãƒªãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º**: å¤‰æ›´ãƒ»æ–°è¦ãƒ»åˆæ ¼ã‚¢ã‚¤ãƒ†ãƒ æ•°ã‚’ä¸€è¦§è¡¨ç¤º

### è¨­å®š

`regconfig.json` ã«è¨­å®šæ¸ˆã¿:

```json
{
  "plugins": {
    "reg-notify-github-plugin": {
      "clientId": "...",
      "prComment": true,
      "prCommentBehavior": "default",
      "setCommitStatus": true,
      "shortDescription": true
    }
  }
}
```

**è¨­å®šã®èª¬æ˜**:
- `prComment: true` - PRã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ–
- `prCommentBehavior: "default"` - æ—¢å­˜ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ï¼ˆ"new"ã§æ¯å›æ–°è¦ã‚³ãƒ¡ãƒ³ãƒˆã€"once"ã§åˆå›ã®ã¿ï¼‰
- `setCommitStatus: true` - å·®åˆ†ãŒã‚ã‚‹å ´åˆã‚³ãƒŸãƒƒãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’failã«è¨­å®š
- `shortDescription: true` - ã‚µãƒãƒªãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤º

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

reg-suit GitHub App ã¯æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã€clientIdã‚‚è¨­å®šæ¸ˆã¿ã§ã™ã€‚
è¿½åŠ ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯ä¸è¦ã§ã€PRã‚’ä½œæˆã™ã‚‹ã¨è‡ªå‹•çš„ã«ã‚³ãƒ¡ãƒ³ãƒˆãŒæŠ•ç¨¿ã•ã‚Œã¾ã™ã€‚

### å‹•ä½œ

1. **PRãŒä½œæˆãƒ»æ›´æ–°ã•ã‚Œã‚‹**: vrt-pr.yml ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®Ÿè¡Œ
2. **VRTæ¯”è¼ƒå®Ÿè¡Œ**: ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒã¨ã®å·®åˆ†ã‚’æ¤œå‡º
3. **PRã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿**: æ¯”è¼ƒçµæœã‚’ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è‡ªå‹•æŠ•ç¨¿
4. **ã‚³ãƒŸãƒƒãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¨­å®š**: å·®åˆ†ãŒã‚ã‚Œã°failã€ãªã‘ã‚Œã°success

---

## æŠ€è¡“è©³ç´°

### ä½¿ç”¨ãƒ„ãƒ¼ãƒ«

| ãƒ„ãƒ¼ãƒ« | ç”¨é€” | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
|--------|------|------------|
| **reg-cli** | ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒæ¯”è¼ƒ | https://github.com/reg-viz/reg-cli |
| **reg-suit** | ãƒªãƒ¢ãƒ¼ãƒˆæ¯”è¼ƒãƒ»GCSé€£æº | https://github.com/reg-viz/reg-suit |
| **Maestro** | E2Eãƒ†ã‚¹ãƒˆãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå–å¾— | https://docs.maestro.dev/ |

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

**regconfig.json** (reg-suitç”¨):
```json
{
  "core": {
    "workingDir": ".reg",
    "actualDir": ".maestro/screenshots",
    "thresholdRate": 0.001
  },
  "plugins": {
    "reg-simple-keygen-plugin": {
      "expectedKey": "${EXPECTED_KEY}",
      "actualKey": "${ACTUAL_KEY}"
    },
    "reg-publish-gcs-plugin": {
      "bucketName": "vrt-sample"
    }
  }
}
```

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**vrt-snapshot-local.ts**: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ
- Gitæœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ãƒã‚§ãƒƒã‚¯
- package.jsonã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³å–å¾—
- Gitæƒ…å ±å–å¾— (ãƒ–ãƒ©ãƒ³ãƒã€ãƒãƒƒã‚·ãƒ¥)
- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆåç”Ÿæˆ
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚³ãƒ”ãƒ¼

**vrt-find-snapshots-local.ts**: ãƒãƒƒã‚·ãƒ¥ã‹ã‚‰æ¯”è¼ƒã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰
- `find`ã‚³ãƒãƒ³ãƒ‰ã§`.maestro/snapshots`é…ä¸‹ã‚’æ¤œç´¢
- reg-cliå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ã‚’ç”Ÿæˆãƒ»å‡ºåŠ›

**vrt-publish-manual.ts**: GCSãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«å®Ÿè¡Œç”¨ï¼‰
- Gitæƒ…å ±å–å¾— (ãƒ–ãƒ©ãƒ³ãƒã€ãƒãƒƒã‚·ãƒ¥ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³)
- 2ã¤ã®GCSã‚­ãƒ¼ã‚’ç”Ÿæˆï¼ˆãƒãƒƒã‚·ãƒ¥ã®ã¿ + ãƒ•ãƒ«ãƒ‘ã‚¹ï¼‰
- reg-suitå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ã‚’ç”Ÿæˆãƒ»å‡ºåŠ›
- **æ³¨**: CI/CDã§ã¯ä½¿ç”¨ã—ã¾ã›ã‚“ï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§ç›´æ¥ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼‰
